<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>unocss-preset-antd-app</title>
    <meta
      name="viewport"
      content="width=device-width, height=device-height, initial-scale=1.0"
    />
    <script>
      // apply theme as early as possible and expose `setTheme/getTheme` to appplication
      // prettier-ignore
      (() => {
        const STORAGE_KEY = "unocss-preset-antd-app:theme";
        const DEFAULT_THEME = "system";
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)");

        function getTheme() {
          return window.localStorage.getItem(STORAGE_KEY) || DEFAULT_THEME;
        }

        function setTheme(config) {
          window.localStorage.setItem(STORAGE_KEY, config);
          applyTheme();
        }

        function applyTheme() {
          const theme = getTheme();
          const derived = theme === "system" ? (prefersDark.matches ? "dark" : "light") : theme;
          disableTransitions(() => {
            document.documentElement.classList.remove("dark", "light");
            document.documentElement.classList.add(derived);
          });
        }

        // https://paco.me/writing/disable-theme-transitions
        function disableTransitions(callback) {
          const el = document.createElement("style");
          el.innerHTML = "* { transition: none !important; }";
          document.head.appendChild(el);
          callback();
          window.getComputedStyle(document.documentElement).transition; // force repaint
          document.head.removeChild(el);
        }

        function initTheme() {
          applyTheme();
          prefersDark.addEventListener("change", applyTheme);
          Object.assign(globalThis, { __theme: { setTheme, getTheme } });
        }

        initTheme();
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script src="./src/index.tsx" type="module"></script>
  </body>
</html>
